Page({
  data: {
    coffeeData: 
    [
      {
        id: 149,
        name: " 去火纤体瓶 ",
        isSelected: false,
        modal: {
        title: " 去火纤体瓶 ",
        selectedIndex: -1,
        items: [
        {type: "标准杯", volume: "500ml", caffeine: "36.8mg", isActive: false},
        { type: "超大杯", volume: "650ml", caffeine: "47.8mg", isActive: false }
        ]
        }
        },
        {
        id: 150,
        name: "羽衣纤体瓶",
        isSelected: false,
        modal: {
        title: "羽衣纤体瓶",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "35.0mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "45.5mg", isActive: false }
        ]
        }
        },
        {
        id: 151,
        name: "多肉桃李",
        isSelected: false,
        modal: {
        title: "多肉桃李",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "18.3mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "23.8mg", isActive: false }
        ]
        }
        },
        {
        id: 152,
        name: "清爽芭乐提",
        isSelected: false,
        modal: {
        title: "清爽芭乐提",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "18.8mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "24.4mg", isActive: false }
        ]
        }
        },
        {
        id: 153,
        name: "多肉葡萄",
        isSelected: false,
        modal: {
        title: "多肉葡萄",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "19.0mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "24.7mg", isActive: false }
        ]
        }
        },
        {
        id: 154,
        name: "轻芝多肉葡萄",
        isSelected: false,
        modal: {
        title: "轻芝多肉葡萄",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "19.0mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "24.7mg", isActive: false }
        ]
        }
        },
        {
        id: 155,
        name: "芒芒甘露",
        isSelected: false,
        modal: {
        title: "芒芒甘露",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "23.7mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "30.8mg", isActive: false }
        ]
        }
        },
        {
        id: 156,
        name: "超多肉芒芒甘露",
        isSelected: false,
        modal: {
        title: "超多肉芒芒甘露",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "10.6mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "13.8mg", isActive: false }
        ]
        }
        },
        {
        id: 157,
        name: "椰椰芒芒",
        isSelected: false,
        modal: {
        title: "椰椰芒芒",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "18.5mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "24.0mg", isActive: false }
        ]
        }
        },
        {
        id: 158,
        name: "鸭喜香轻柠茶",
        isSelected: false,
        modal: {
        title: "鸭喜香轻柠茶",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "89.5mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "116.4mg", isActive: false }
        ]
        }
        },
        {
        id: 159,
        name: "绿妍轻柠茶",
        isSelected: false,
        modal: {
        title: "绿妍轻柠茶",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "101.5mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "132.0mg", isActive: false }
        ]
        }
        },
        {
        id: 160,
        name: "多肉青提",
        isSelected: false,
        modal: {
        title: "多肉青提",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "未知", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "未知", isActive: false }
        ]
        }
        },
        {
        id: 161,
        name: "多肉芒芒",
        isSelected: false,
        modal: {
        title: "多肉芒芒",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "20.4mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "26.5mg", isActive: false }
        ]
        }
        },
        {
        id: 162,
        name: "满杯红柚",
        isSelected: false,
        modal: {
        title: "满杯红柚",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "27.2mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "35.4mg", isActive: false }
        ]
        }
        },
        {
        id: 163,
        name: "咸酪厚抹",
        isSelected: false,
        modal: {
        title: "咸酪厚抹",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "115.0mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "149.5mg", isActive: false }
        ]
        }
        },
        {
        id: 164,
        name: "芝芝抹茶",
        isSelected: false,
        modal: {
        title: "芝芝抹茶",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "未知", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "未知", isActive: false }
        ]
        }
        },
        {
        id: 165,
        name: "三倍厚抹",
        isSelected: false,
        modal: {
        title: "三倍厚抹",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "167.0mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "217.1mg", isActive: false }
        ]
        }
        },
        {
        id: 166,
        name: "小奶茉",
        isSelected: false,
        modal: {
        title: "小奶茉",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "144.0mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "187.2mg", isActive: false }
        ]
        }
        },
        {
        id: 167,
        name: "芝芝绿妍茶后",
        isSelected: false,
        modal: {
        title: "芝芝绿妍茶后",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "72.0mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "93.6mg", isActive: false }
        ]
        }
        },
        {
        id: 168,
        name: "纯绿妍茶后",
        isSelected: false,
        modal: {
        title: "纯绿妍茶后",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "99.0mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "128.7mg", isActive: false }
        ]
        }
        },
        {
        id: 169,
        name: "牦牛乳酥油茶",
        isSelected: false,
        modal: {
        title: "牦牛乳酥油茶",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "105.0mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "136.5mg", isActive: false }
        ]
        }
        },
        {
        id: 170,
        name: "烤布蕾油切乌龙冰",
        isSelected: false,
        modal: {
        title: "烤布蕾油切乌龙冰",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "176.0mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "228.8mg", isActive: false }
        ]
        }
        },
        {
        id: 171,
        name: "烤布蕾抹茶冰",
        isSelected: false,
        modal: {
        title: "烤布蕾抹茶冰",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "72.5mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "94.3mg", isActive: false }
        ]
        }
        },
        {
        id: 172,
        name: "抹茶波波冰",
        isSelected: false,
        modal: {
        title: "抹茶波波冰",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "125.0mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "162.5mg", isActive: false }
        ]
        }
        },
        {
        id: 173,
        name: "烤布蕾奶茶冰",
        isSelected: false,
        modal: {
        title: "烤布蕾奶茶冰",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "40.0mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "52.0mg", isActive: false }
        ]
        }
        },
        {
        id: 174,
        name: "奶茶波波冰",
        isSelected: false,
        modal: {
        title: "奶茶波波冰",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "55.0mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "71.5mg", isActive: false }
        ]
        }
        },
        {
        id: 175,
        name: "烤黑糖波波牛乳茶",
        isSelected: false,
        modal: {
        title: "烤黑糖波波牛乳茶",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "未知", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "未知", isActive: false }
        ]
        }
        },
        {
        id: 176,
        name: "嫣红牛乳茶",
        isSelected: false,
        modal: {
        title: "嫣红牛乳茶",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "未知", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "未知", isActive: false }
        ]
        }
        },
        {
        id: 177,
        name: "热烤黑糖波波牛乳茶",
        isSelected: false,
        modal: {
        title: "热烤黑糖波波牛乳茶",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "未知", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "未知", isActive: false }
        ]
        }
        },
        {
        id: 178,
        name: "热烤黑糖波波牛乳",
        isSelected: false,
        modal: {
        title: "热烤黑糖波波牛乳",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "0.0mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "0.0mg", isActive: false }
        ]
        }
        },
        {
        id: 179,
        name: "热咸酪厚抹",
        isSelected: false,
        modal: {
        title: "热咸酪厚抹",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "115.0mg", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "149.5mg", isActive: false }
        ]
        }
        },
        {
        id: 180,
        name: "热芝芝抹茶",
        isSelected: false,
        modal: {
        title: "热芝芝抹茶",
        selectedIndex: -1,
        items: [
        { type: "标准杯", volume: "500ml", caffeine: "未知", isActive: false },
        { type: "超大杯", volume: "650ml", caffeine: "未知", isActive: false }
        ]
        }
        },{ id: 181, name: "热小奶茉", isSelected: false, modal: { title: "热小奶茉", selectedIndex: -1, items: [ { type: "标准杯", volume: "500ml", caffeine: "144.0mg", isActive: false }, { type: "超大杯", volume: "650ml", caffeine: "187.2mg", isActive: false } ] } }, { id: 182, name: "热三倍厚抹", isSelected: false, modal: { title: "热三倍厚抹", selectedIndex: -1, items: [ { type: "标准杯", volume: "500ml", caffeine: "167.0mg", isActive: false }, { type: "超大杯", volume: "650ml", caffeine: "217.1mg", isActive: false } ] } }, { id: 183, name: "芝芝多肉葡萄", isSelected: false, modal: { title: "芝芝多肉葡萄", selectedIndex: -1, items: [ { type: "标准杯", volume: "500ml", caffeine: "23.0mg", isActive: false }, { type: "超大杯", volume: "650ml", caffeine: "29.9mg", isActive: false } ] } }, { id: 184, name: "芝芝多肉青提", isSelected: false, modal: { title: "芝芝多肉青提", selectedIndex: -1, items: [ { type: "标准杯", volume: "500ml", caffeine: "22.0mg", isActive: false }, { type: "超大杯", volume: "650ml", caffeine: "28.6mg", isActive: false } ] } }, { id: 185, name: "芝芝芒芒", isSelected: false, modal: { title: "芝芝芒芒", selectedIndex: -1, items: [ { type: "标准杯", volume: "500ml", caffeine: "24.0mg", isActive: false }, { type: "超大杯", volume: "650ml", caffeine: "31.2mg", isActive: false } ] } }
    ],
          
    showModal: false,
    currentModal: {}
  },

  handleItemTap(e) {
    const index = e.currentTarget.dataset.index;
    const selectedCoffee = this.data.coffeeData[index];

    // 重置所有咖啡的选中状态
    const updatedList = this.data.coffeeData.map((item, i) => {
      item.isSelected = i === index;
      return item;
    });

    this.setData({
      coffeeData: updatedList,
      currentModal: selectedCoffee.modal,
      showModal: true
    });
  },

  selectCupType(e) {
    const index = e.currentTarget.dataset.index;
    const title = this.data.currentModal.title;
    
    // 找到当前操作的咖啡项
    const coffeeIndex = this.data.coffeeData.findIndex(item => item.modal.title === title);
    if (coffeeIndex !== -1) {
      // 更新当前咖啡项的杯型选中状态
      const updatedCoffeeData = [...this.data.coffeeData];
      updatedCoffeeData[coffeeIndex].modal.items.forEach((item, i) => {
        item.isActive = i === index;
      });
      
      // 更新选中索引
      updatedCoffeeData[coffeeIndex].modal.selectedIndex = index;
      
      // 更新数据
      this.setData({
        coffeeData: updatedCoffeeData,
        currentModal: updatedCoffeeData[coffeeIndex].modal
      });
    }
  },

  closeModal() {
    this.setData({
      showModal: false
    });
  },

  confirmSelection() {
    const { title, selectedIndex, items } = this.data.currentModal;
    if (selectedIndex === -1) {
      wx.showToast({
        title: "请选择一个杯型",
        icon: "none"
      });
      return;
    }
    const selectedCup = items[selectedIndex];
    wx.showToast({
      title: `已选择${title}的${selectedCup.type}杯型`,
      icon: "none"
    });
    this.closeModal();
  },

  toHome() { /* 跳转首页逻辑 */ },
  toCoffeeRecord() { /* 跳转咖啡记录逻辑 */ },
  toMy() { /* 跳转我的逻辑 */ }
});
