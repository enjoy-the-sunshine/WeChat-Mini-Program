<view class="page">

<!-- 顶部日历 -->
<view class="calendar-container shadow">
  <view class="calendar-header">
    <text class="arrow" bindtap="prevMonth">‹</text>
    <text class="current-date">{{currentYear}}年{{currentMonth}}月</text>
    <text class="arrow" bindtap="nextMonth">›</text>
  </view>

  <!-- 星期标题 -->
  <view class="weekdays">
    <text wx:for="{{['日','一','二','三','四','五','六']}}" wx:key="*this" class="weekday">{{item}}</text>
  </view>

  <!-- 日期 -->
  <view class="days">
    <view
      wx:for="{{days}}"
      wx:key="index"
      class="day {{item.isCurrentMonth ? '' : 'other-month'}} {{selectedDate === item.dateString ? 'selected' : ''}}"
      bindtap="selectDate"
      data-date="{{item.dateString}}"
    >
      {{item.date}}
    </view>
  </view>
</view>

<!-- 下方咖啡因统计 -->
<view class="caffeine-summary shadow">
  <text class="summary-date">{{selectedDateDisplay}}  星期{{selectedWeekday}}</text>
  <view class="summary-row">
    <text class="summary-title">今日总计咖啡因</text>
    <text class="summary-value">{{totalCaffeine}}<text class="unit">mg</text></text>
  </view>
</view>

<!-- 单日饮品记录 -->
<!-- 饮品记录 -->
<view class="drink-record shadow" bindtap="openEditPopup">
  <image class="drink-icon" src="/images/coffee-icon.png" mode="aspectFit"></image>
  <view class="drink-info">
    <text class="drink-name">美式咖啡</text>
    <text class="drink-time">\n 9:24</text>
  </view>
  <text class="drink-caffeine">150mg</text>
  <text class="record-arrow">></text>
</view>
<!-- 按钮 -->
<view class="btn-group">
  <button class="btn-add shadow">追加记录</button>
  <button class="btn-state shadow">状态记录</button>
</view>

<!-- 底部小熊插图 -->
<view class="bear-container">
  <image src="/images/bear.png" mode="widthFix" class="bear-img"></image>
</view>

</view>

<view class="popup-mask" wx:if="{{showEditPopup}}" bindtap="closeEditPopup">
  <view class="popup-container" catchtap="stopTap">
    <!-- 关闭按钮 -->
    <image src="/images/close-icon.png" class="popup-close-btn" bindtap="closeEditPopup"></image>

    <view class="popup-title">编辑记录</view>

    <!-- 饮品 -->
    <view class="popup-field">
      <image src="/images/drink-icon.png" class="popup-icon"></image>
      <text class="popup-label">饮品</text>
      <view class="popup-inner-input">
        <input value="{{drinkName}}" bindinput="onDrinkNameInput" />
      </view>
    </view>

    <!-- 日期 -->
    <view class="popup-field">
      <image src="/images/calendar-icon.png" class="popup-icon"></image>
      <text class="popup-label">日期</text>
      <view class="popup-inner-input">
        <input value="{{drinkDate}}" bindinput="onDrinkDateInput" />
      </view>
    </view>

    <!-- 时间 -->
    <view class="popup-field">
      <image src="/images/time-icon.png" class="popup-icon"></image>
      <text class="popup-label">时间</text>
      <view class="popup-inner-input">
        <input value="{{drinkTime}}" bindinput="onDrinkTimeInput" />
      </view>
    </view>

    <!-- 咖啡因含量（固定不输入） -->
    <view class="popup-field">
      <image src="/images/caffeine-icon.png" class="popup-icon"></image>
      <text class="popup-label">咖啡因含量</text>
      <view class="popup-caffeine-display">
        <text class="popup-caffeine-value">150</text>
        <text class="popup-unit">mg</text>
      </view>
    </view>

    <!-- 删除按钮 -->
    <view class="popup-field delete-btn" bindtap="onDeleteRecord">
      <text>删除此记录...</text>
    </view>
  </view>
</view>
