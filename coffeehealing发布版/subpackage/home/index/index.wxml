<!-- 微信风格对话界面 -->
<view class="chat-page">
  <!-- 背景图片 -->
  <image class="chat-bg" src="../images/coffee-bg.png" mode="aspectFill"></image>
  
  <!-- 顶部导航栏 -->
  <view class="nav-bar">
    <view class="nav-content">
      <image class="nav-avatar" src="../images/bot-avatar.png" mode="aspectFit" />
      <text class="nav-title">咖啡因管理小熊</text>
    </view>
  </view>
  
  <!-- 消息区域 -->
  <scroll-view 
    class="message-area" 
    scroll-y 
    scroll-with-animation
    bindscrolltolower="onScrollToLower"
    bindscroll="onScroll"
    scroll-top="{{scrollTop}}"
    enhanced
    show-scrollbar="{{false}}">
    
    <!-- 欢迎消息 -->
    <view class="welcome-msg" wx:if="{{messages.length === 0}}">
      <view class="welcome-avatar">
        <image class="avatar-img" src="../images/bot-avatar.png" mode="aspectFit" />
      </view>
      <view class="welcome-bubble">
        <text class="welcome-text">嗨，你好！我是咖啡因管理小熊，你的可靠小伙伴，关于咖啡相关的内容我都比较了解，你有什么想问我的吗？</text>
        <view class="quick-actions">
          <view 
            class="quick-action-btn" 
            wx:for="{{quickQuestions}}" 
            wx:key="index"
            bindtap="sendQuickQuestion" 
            data-question="{{item}}">
            {{item}}
          </view>
        </view>
      </view>
    </view>
    
    <!-- 消息列表 -->
    <view class="msg-list">
      <view 
        wx:for="{{messages}}" 
        wx:key="id" 
        class="msg-item {{item.role === 'user' ? 'user-msg' : 'bot-msg'}}">
        
        <!-- 机器人消息 -->
        <view class="bot-msg-content" wx:if="{{item.role === 'bear'}}">
          <image class="msg-avatar" src="../images/bot-avatar.png" mode="aspectFit" />
          <view class="msg-bubble bot-bubble">
            <text class="msg-text">{{item.content}}</text>
          </view>
        </view>
        
        <!-- 用户消息 -->
        <view class="user-msg-content" wx:if="{{item.role === 'user'}}">
          <view class="msg-bubble user-bubble">
            <text class="msg-text">{{item.content}}</text>
          </view>
          <image class="msg-avatar" src="../images/user-avatar.png" mode="aspectFit" />
        </view>
      </view>
      
      <!-- 正在输入提示 -->
      <view class="typing-indicator" wx:if="{{isLoading}}">
        <image class="typing-avatar" src="../images/bot-avatar.png" mode="aspectFit" />
        <view class="typing-bubble">
          <view class="typing-dots">
            <view class="typing-dot"></view>
            <view class="typing-dot"></view>
            <view class="typing-dot"></view>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>
  
  <!-- 快捷问题 -->
  <view class="quick-questions" wx:if="{{!isLoading && messages.length > 0}}">
    <scroll-view class="quick-scroll" scroll-x="true" show-scrollbar="{{false}}">
      <view class="quick-list">
        <view 
          class="quick-item" 
          wx:for="{{quickQuestions}}" 
          wx:key="index"
          bindtap="sendQuickQuestion" 
          data-question="{{item}}">
          {{item}}
        </view>
      </view>
    </scroll-view>
  </view>
  
  <!-- 输入框 -->
  <view class="input-bar">
    <view class="input-wrapper">
      <input 
        class="text-input" 
        placeholder="发送消息..." 
        value="{{inputMessage}}"
        bindinput="onInput"
        bindconfirm="sendMessage"
        focus="{{autoFocus}}"
        confirm-type="send"
      />
      <button 
        class="send-btn {{inputMessage.trim() && !isLoading ? 'send-active' : ''}}" 
        bindtap="sendMessage"
        disabled="{{isLoading}}" style="width: 150rpx; display: flex; box-sizing: border-box; left: 0rpx; top: 0rpx">
        <text class="send-text">发送</text>
      </button>
    </view>
  </view>
  
  <!-- 底部提示 -->
  <view class="footer-tip">
    <text class="tip-text">内容由AI生成，无法确保真实准确，仅供参考。</text>
  </view>
</view>