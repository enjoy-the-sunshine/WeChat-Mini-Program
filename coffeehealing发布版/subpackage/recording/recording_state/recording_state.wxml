<view class="page">
  <!-- 今日心情 -->
  <view class="panel panel-white panel-mood">
    <view class="panel-header">
      <text class="h2">今日心情</text>
    </view>

    <view class="mood-container">
      <!-- 左侧：大图 + 文字 -->
      <view class="mood-hero">
        <image class="hero-img" src="{{moodBigMap[mood].src}}" mode="aspectFit" />
        <text class="hero-text">{{moodBigMap[mood].text}}</text>
      </view>

      <!-- 右侧：心情选择网格 -->
      <view class="mood-grid">
        <block wx:for="{{moodList}}" wx:key="id">
          <view class="mood-item {{mood===item.id?'active':''}}" bindtap="onPickMood" data-id="{{item.id}}">
            <image class="mood-img" src="{{item.src}}" mode="aspectFit" style="width: 95rpx; height: 85rpx; display: block; box-sizing: border-box; position: relative; left: 3rpx; top: 0rpx"></image>
          </view>
        </block>
      </view>
    </view>
  </view>

  <!-- 睡眠记录 -->
  <view class="panel panel-sleep">
    <view class="panel-header">
      <view class="h2-row">
        <text class="h2">睡眠记录</text>
        <image class="head-icon" src="{{icons.mooncloud}}" mode="widthFix" />
      </view>
    </view>

    <view class="sleep-content">
      <!-- 第1行：入睡时间 / 睡眠时长 -->
      <view class="kv-row">
        <view class="kv-box">
          <view class="kv-title">
            <image class="kv-icon" src="{{icons.moon}}" mode="widthFix" />
            <text>入睡时间</text>
          </view>
          <picker mode="time" value="{{sleepTime}}" start="00:00" end="23:59" bindchange="onChangeTime">
            <view class="kv-value" style="width: 239rpx; display: block; box-sizing: border-box; position: relative; left: 0rpx; top: 0rpx">{{sleepTime}}  ＞</view>
          </picker>
        </view>

        <view class="kv-box duration-box">
          <view class="kv-title">
            <image class="kv-icon" src="{{icons.clock}}" mode="widthFix" />
            <text>睡眠时长</text>
          </view>
          <picker mode="selector" range="{{durationOptions}}" value="{{durationIndex}}" bindchange="onChangeDuration">
            <view class="kv-value" style="width: 262rpx; display: block; box-sizing: border-box; position: relative; left: -22rpx; top: 0rpx">{{durationText}} ＞</view>
          </picker>
        </view>
      </view>

      <!-- 第2行：效率 / 评分 -->
      <view class="kv-row compact-row">
        <view class="kv-box compact-box">
          <view class="kv-title">
            <image class="kv-icon" src="{{icons.star}}" mode="widthFix" />
            <text>睡眠效率</text>
          </view>
          <view class="compact-control">
            <view class="compact-value" style="width: 79rpx; display: block; box-sizing: border-box">{{sleepEfficiency}}%</view>
            <view class="compact-buttons">
              <view class="compact-btn" bindtap="onDecreaseEfficiency" 
                    bindlongpress="onLongPressDecreaseEfficiency" 
                    bindtouchend="onTouchEndEfficiency">-</view>
              <view class="compact-btn" bindtap="onIncreaseEfficiency" 
                    bindlongpress="onLongPressIncreaseEfficiency" 
                    bindtouchend="onTouchEndEfficiency">+</view>
            </view>
          </view>
        </view>

        <view class="kv-box compact-box">
          <view class="kv-title">
            <image class="kv-icon" src="{{icons.like}}" mode="widthFix" />
            <text>睡眠评分</text>
          </view>
          <view class="compact-control">
            <view class="compact-value">{{sleepScore}}分</view>
            <view class="compact-buttons">
              <view class="compact-btn" bindtap="onDecreaseScore" 
                    bindlongpress="onLongPressDecreaseScore" 
                    bindtouchend="onTouchEndScore">-</view>
              <view class="compact-btn" bindtap="onIncreaseScore" 
                    bindlongpress="onLongPressIncreaseScore" 
                    bindtouchend="onTouchEndScore">+</view>
            </view>
          </view>
        </view>
      </view>

      <!-- 睡眠感受 -->
      <view class="feel-wrap">
        <text class="feel-label">睡眠感受</text>
        <view class="feel-group" style="width: 443rpx; display: flex; box-sizing: border-box">
          <block wx:for="{{feelList}}" wx:key="id">
            <view class="feel-item {{feel===item.id?'sel':''}}" bindtap="onPickFeel" data-id="{{item.id}}">
              <image class="feel-img" src="{{item.src}}" mode="aspectFit"></image>
            </view>
          </block>
        </view>
      </view>
    </view>
  </view>

  <!-- 元气熊日志 -->
  <view class="panel panel-white panel-journal">
    <view class="panel-header compact-header">
      <text class="h2">元气熊の日志</text>
    </view>

    <view class="journal compact-journal">
      <image class="bear compact-bear" src="{{images.bearDiary}}" mode="widthFix" />
      <view class="note-box compact-note-box" style="height: 158rpx; display: block; box-sizing: border-box; left: 0rpx; top: 0rpx">
        <image class="paperclip" src="{{icons.paperclip}}" mode="widthFix" />
        <textarea style="height: 110rpx; display: block; box-sizing: border-box; left: 0rpx; top: 0rpx" class="note compact-note" placeholder="记录美好生活呀！" maxlength="300"
                  value="{{note}}" bindinput="onInputNote"/>
        <image class="pen" src="{{icons.pen}}" mode="widthFix" />
      </view>
    </view>
  </view>

  <!-- 确认按钮 -->
  <view class="footer">
    <view class="btn-primary" hover-class="btn-primary--active" bindtap="onSubmit">确认</view>
  </view>
</view>
