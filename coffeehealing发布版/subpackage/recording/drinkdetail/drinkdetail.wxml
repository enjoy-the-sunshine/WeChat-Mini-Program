<view class="page">
  <!-- щеочФичЩ╛хИЖцпФ -->
  <view class="section percentage-section" wx:if="{{isCustom}}">
    <view class="section-title">
      <view class="title-icon">ЁЯУК</view>
      <text>щеочФичЩ╛хИЖцпФ</text>
    </view>
    <view class="percentage-card" style="height: 133rpx; display: flex; box-sizing: border-box">
      <view class="percentage-left">
        <view class="percentage-info">
          <text class="percentage-label">хоЮщЩЕщеочФищЗП</text>
          <text class="percentage-subtitle">ш░ГцХ┤цВихоЮщЩЕщеочФичЪДщЗП</text>
        </view>
      </view>
      <view class="percentage-right">
        <view class="percentage-display">
          <view class="percentage-amount" style="position: relative; left: -70rpx; top: 11rpx">
            <text class="percentage-value">{{drinkPercentage || 100}}</text>
            <text class="percentage-unit">%</text>
          </view>
          <view class="percentage-slider">
            <slider style="width: 249rpx; display: block; box-sizing: border-box; left: -70rpx; position: relative; top: 0rpx" min="0" max="100" value="{{drinkPercentage || 100}}" 
                    activeColor="#D2691E" backgroundColor="#f0f0f0" 
                    block-size="24" block-color="#D2691E" 
                    bindchange="onPercentageChange" bindchanging="onPercentageChanging"/>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- цЭпхЮЛщАЙцЛй -->
  <view class="section cups-section" wx:if="{{!isCustom}}">
    <view class="section-title">
      <view class="title-icon">тШХ</view>
      <text>щАЙцЛйцЭпхЮЛ</text>
    </view>
    <view class="cups">
      <view wx:for="{{sizeOptions}}" wx:key="size_key"
            class="cup-item {{cupSize === item.size_key ? 'selected' : ''}}"
            data-size="{{item.size_key}}" bindtap="selectCup">
        <view class="cup-image-wrapper">
          <image src="{{item.cupImage}}" class="cup-img"></image>
          <view class="selection-badge" wx:if="{{cupSize === item.size_key}}">тЬУ</view>
        </view>
        <text class="cup-text">{{item.size_key}}</text>
        <text class="cup-volume">{{item.size_ml ? item.size_ml + 'ml' : ''}}</text>
        <view class="cup-add-btn" data-size="{{item.size_key}}" bindtap="showInputModal">
          <image src="../images/add-icon.png" class="add-icon"></image>
        </view>
      </view>
    </view>
  </view>

  <!-- щеочФицЧ╢щЧ┤ -->
  <view class="section time-section">
    <view class="section-title">
      <view class="title-icon">ЁЯХР</view>
      <text>щеочФицЧ╢щЧ┤</text>
    </view>
    <view class="time-card">
      <view class="time-left">
        <image src="../images/time2.png" class="time-illustration"></image>
        <view class="time-info">
          <text class="time-label">х╜УхЙНщАЙцЛй</text>
          <text class="time-subtitle">шо░х╜ХщеочФицЧ╢щЧ┤</text>
        </view>
      </view>
      <view class="time-right">
        <picker mode="time" value="{{drinkTime}}" start="00:00" end="23:59" bindchange="onTimeChange">
          <view class="time-picker">
            <view class="time-display">
              <text class="time-value">{{drinkTime || 'чВ╣хЗ╗щАЙцЛй'}}</text>
              <view class="time-arrow">тЦ╝</view>
            </view>
          </view>
        </picker>
      </view>
    </view>
  </view>

  <!-- хТЦхХбхЫахРлщЗП -->
  <view class="section caffeine-section">
    <view class="section-title">
      <view class="title-icon">тЪб</view>
      <text>хТЦхХбхЫахРлщЗП</text>
    </view>
    <view class="caffeine-card">
      <view class="caffeine-left">
        <image src="../images/caffeine2.png" class="caffeine-illustration"></image>
        <view class="caffeine-info">
          <text class="caffeine-label">щвДшобцСДхЕещЗП</text>
          <text class="caffeine-subtitle">хЯ║ф║ОцаЗхЗЖщЕНцЦ╣шобчоЧ</text>
        </view>
      </view>
      <view class="caffeine-right">
        <view class="caffeine-display">
          <view class="caffeine-amount">
            <text class="caffeine-value">{{caffeineAmount || '--'}}</text>
            <text class="caffeine-unit">mg</text>
          </view>
          <view class="caffeine-bar">
            <view class="bar-track">
              <view class="bar-fill" style="width: {{cupSize ? '100%' : '0%'}}"></view>
            </view>
            <text class="bar-text" wx:if="{{!isCustom}}">{{cupSize ? 'х╖▓щАЙцЛй' : 'цЬкщАЙцЛй'}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ц╖╗хКацМЙщТо -->
  <view class="action-section">
    <button class="add-btn {{(cupSize || isCustom) ? 'active' : 'disabled'}}" bindtap="goBackToCaffeine" disabled="{{!cupSize && !isCustom}}">
      <view class="btn-content">
        <text class="btn-text">чбошодц╖╗хКа</text>
        <view class="btn-icon">тЬУ</view>
      </view>
    </button>
  </view>

  <!-- ш╛УхЕещеочФищЗПх╝╣чкЧ -->
  <view wx:if="{{showModal}}" class="modal-mask">
    <view class="modal-container">
      <view class="modal-header">
        <view class="modal-title-wrapper">
          <text class="modal-title">шо╛ч╜ощеочФищЗП</text>
          <text class="modal-subtitle">ф╕║ {{currentCup}} шо╛ч╜охоЮщЩЕщеочФищЗП</text>
        </view>
        <view class="modal-close" bindtap="closeModal">
          <image src="../images/close-icon.png" class="close-icon"></image>
        </view>
      </view>
      <view class="modal-body">
        <view class="input-section">
          <text class="input-label">щеочФищЗПчЩ╛хИЖцпФ</text>
          <view class="input-wrapper">
            <input type="number" bindinput="onAmountInput" class="modal-input" placeholder="0" value="{{amount}}" maxlength="3"/>
            <text class="input-unit">%</text>
          </view>
          <view class="input-slider">
            <slider min="0" max="100" value="{{amount}}" activeColor="#D2691E" backgroundColor="#f0f0f0" block-size="24" block-color="#D2691E" bindchange="onSliderInput" bindchanging="onSliderInput"/>
          </view>
        </view>
      </view>
      <view class="modal-actions">
        <button class="modal-cancel" bindtap="closeModal">хПЦц╢И</button>
        <button class="modal-confirm" bindtap="confirmAmount">чбохоЪ</button>
      </view>
    </view>
  </view>

  <!-- ш╢ЕцаЗцПРчд║х╝╣чкЧ - х╖▓чз╗хИ░цЬАхдЦх▒В -->
  <view class="warn-modal" wx:if="{{modalVisible}}">
    <view class="warn-modal-content">
      <!-- цаЗщвШхМ║ -->
      <view class="warn-modal-header">
        <image src="../images/avatar.png" class="warn-modal-icon" />
        <text class="warn-modal-title">{{modalTitle}}</text>
      </view>

      <!-- цПРчд║цЦЗхнЧ -->
      <text class="warn-modal-text">{{modalMessage}}</text>

      <!-- цМЙщТо -->
      <view class="warn-modal-actions">
        <button class="warn-modal-button warn-modal-button-confirm" bindtap="confirmModal">чбошод</button>
        <button class="warn-modal-button warn-modal-button-cancel" bindtap="hideModal">ш┐ФхЫЮ</button>
      </view>
    </view>
  </view>

</view>
