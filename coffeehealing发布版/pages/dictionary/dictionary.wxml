<!-- pages/dictionary/dictionary.wxml -->
<view class="container">
  <!-- цВмц╡оцФ╢шЧПцаПхТМшЗкхоЪф╣ЙцаП -->
  <view class="floating-bars">
    <view class="floating-bar {{activeCategory === 'favorite' ? 'active' : ''}}" bindtap="switchToFavorite">
      <view class="bar-icon">ЁЯФО</view>
      <text class="bar-text">цРЬч┤в</text>
    </view>
    <view class="floating-bar {{activeCategory === 'custom' ? 'active' : ''}}" bindtap="switchToCustom">
      <view class="bar-icon">тЪЩя╕П</view>
      <text class="bar-text">шЗкхоЪф╣Й</text>
    </view>
  </view>

  <!-- ф╕╗хЖЕхо╣хМ║хЯЯ -->
  <view class="main-content">
    <view class="page-title"><text class="title-text">ч▓╛щАЙшМ╢щеохУБчЙМ</text></view>

    <view class="brand-grid">
      <view wx:for="{{brands}}" wx:key="id" class="brand-card" bindtap="selectBrand" data-brand="{{item}}">
        <view class="card-logo-container">
          <image class="brand-logo" src="{{item.logoUrl}}" mode="aspectFit" lazy-load="true"/>
        </view>
        <text class="brand-name">{{item.name}}</text>
      </view>
    </view>

    <view wx:if="{{brands.length === 0}}" class="empty-state">
      <view class="empty-icon">ЁЯУн</view>
      <text class="empty-text">цЪВцЧахУБчЙМцХ░цНо</text>
    </view>
  </view>

  <!-- цРЬч┤вщеохУБх╝╣чкЧ -->
  <view wx:if="{{showFavoriteModal}}" class="modal-overlay {{showFavoriteModal ? 'show' : ''}}" bindtap="hideFavoriteModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <view class="modal-icon">ЁЯзЛ</view>
        <text class="modal-title">цРЬч┤вщеохУБ</text>
        <view class="modal-close" bindtap="hideFavoriteModal">├Ч</view>
      </view>

      <view class="modal-body">
        <view class="search-bar">
          <input class="search-input"
                 placeholder="ш╛УхЕехУБчЙМхРН"
                 confirm-type="search"
                 bindconfirm="doSearch"
                 bindinput="onSearchInput"
                 value="{{searchKeyword}}" />
          <button class="btn btn-primary" bindtap="doSearch">цРЬч┤в</button>
        </view>

        <!-- ч╗УцЮЬхИЧшбия╝Иф╗Нч╗СхоЪхОЯцХ░цНо/ф║Лф╗╢я╝Й -->
        <view wx:for="{{favorites}}" wx:key="id" class="search-result" bindtap="selectFavoriteDrink" data-drink="{{item}}">
          <image class="brand-icon" src="{{item.logoUrl}}" mode="aspectFill"></image>
          <text class="brand-name">{{item.name}}</text>
        </view>

        <view wx:if="{{!favorites.length}}" class="empty-favorites">
          <view class="empty-icon">тнР</view>
          <text class="empty-text">цЪВцЧацРЬч┤вч╗УцЮЬ</text>
        </view>
      </view>
    </view>
  </view>

  <!-- шЗкхоЪф╣ЙщеохУБх╝╣чкЧ -->
  <view wx:if="{{showCustomModal}}" class="modal-overlay {{showCustomModal ? 'show' : ''}}" bindtap="hideCustomModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <view class="modal-icon">ЁЯЫая╕П</view>
        <text class="modal-title">шЗкхоЪф╣ЙщеохУБ</text>
        <view class="modal-close" bindtap="hideCustomModal">├Ч</view>
      </view>

      <view class="modal-body">
        <view class="custom-add-btn" bindtap="showAddCustomModal">
          <text class="custom-add-icon">+</text>
          <text class="custom-add-text">ц╖╗хКашЗкхоЪф╣ЙщеохУБ</text>
        </view>

        <view wx:for="{{customDrinks}}" wx:key="id" class="custom-item" bindtap="selectCustomDrink" data-drink="{{item}}">
          <view class="drink-icon">{{item.emoji || 'тШХ'}}</view>
          <view class="drink-info">
            <text class="drink-name">{{item.name}}</text>
            <text class="drink-caffeine">{{item.caffeine}} mg{{item.unit || ''}}</text>
          </view>
          <view class="delete-btn" catchtap="deleteCustomDrink" data-drink-id="{{item.id}}">
            <text class="delete-icon">ЁЯЧСя╕П</text>
          </view>
        </view>

        <view wx:if="{{customDrinks.length === 0}}" class="empty-custom">
          <view class="empty-icon">тЪЩя╕П</view>
          <text class="empty-text">цЪВцЧашЗкхоЪф╣ЙщеохУБ</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ц╖╗хКашЗкхоЪф╣ЙщеохУБх╝╣чкЧ -->
  <view wx:if="{{showAddCustomModal}}" class="modal-overlay {{showAddCustomModal ? 'show' : ''}}" bindtap="hideAddCustomModal">
    <view class="modal-content" catchtap="stopPropagation">
      <view class="modal-header">
        <view class="modal-icon">ЁЯР╗</view>
        <text class="modal-title">ц╖╗хКашЗкхоЪф╣ЙщеохУБ</text>
        <view class="modal-close" bindtap="hideAddCustomModal">├Ч</view>
      </view>

      <view class="modal-body">
        <view class="form-item">
          <text class="form-label">щеохУБхРНчз░</text>
          <input class="form-input" placeholder="шп╖ш╛УхЕещеохУБхРНчз░"
                 value="{{customDrink.name}}" bindinput="onCustomNameInput"/>
        </view>

        <view class="form-item">
          <text class="form-label">хТЦхХбхЫахРлщЗП (mg)</text>
          <input class="form-input" type="number" placeholder="шп╖ш╛УхЕехТЦхХбхЫахРлщЗП"
                 value="{{customDrink.caffeine}}" bindinput="onCustomCaffeineInput"/>
        </view>
      </view>

      <view class="modal-footer">
        <button class="btn btn-ghost" bindtap="hideAddCustomModal">хПЦц╢И</button>
        <button class="btn btn-primary" bindtap="addCustomDrink">чбохоЪ</button>
      </view>
    </view>
  </view>
</view>
